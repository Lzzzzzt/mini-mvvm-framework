var f=Object.defineProperty;var m=(c,t,r)=>t in c?f(c,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):c[t]=r;var o=(c,t,r)=>(m(c,typeof t!="symbol"?t+"":t,r),r);const b=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))s(e);new MutationObserver(e=>{for(const i of e)if(i.type==="childList")for(const n of i.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&s(n)}).observe(document,{childList:!0,subtree:!0});function r(e){const i={};return e.integrity&&(i.integrity=e.integrity),e.referrerpolicy&&(i.referrerPolicy=e.referrerpolicy),e.crossorigin==="use-credentials"?i.credentials="include":e.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(e){if(e.ep)return;e.ep=!0;const i=r(e);fetch(e.href,i)}};b();class h{constructor(){o(this,"subscriber");this.subscriber=new Map}add(t){this.subscriber.set(t.id,t)}publish(){this.subscriber.forEach(t=>{t.update()})}}o(h,"target",null);class g{constructor(t){o(this,"data");this.data=t,this.traversal(null,this.data,1)}traversal(t,r,s){r.__parent__=t,Object.keys(r).forEach(e=>{e!=="__parent__"&&(this.reactive(r,e,r[e]),typeof r[e]=="object"&&this.traversal(r,r[e],s+1))})}reactive(t,r,s){const e=new h;Object.defineProperty(t,r,{configurable:!0,enumerable:!0,get(){return h.target&&e.add(h.target),s},set(i){s=i,e.publish()}})}}class l{constructor(t,r,s){o(this,"id");o(this,"expr");o(this,"context");o(this,"callback");this.expr=t,this.context=r,this.callback=s,this.id=Symbol("Subscriber ID"),this.update()}getCurrentValue(){h.target=this;const t=new Function("context",`
            with(context) {
                return ${this.expr}
            }
        `)(this.context);return h.target=null,t}update(){this.callback(this.getCurrentValue())}}class x{constructor(t){o(this,"$frag");o(this,"$el");o(this,"$context");this.$context=t,this.$el=t.$el,this.$frag=this.node2frag(this.$el),this.parse(this.$frag),this.$el.appendChild(this.$frag)}node2frag(t){let r=document.createDocumentFragment();return t&&t.childNodes.forEach(s=>{s.nodeType===Node.TEXT_NODE&&/^[\r\n]/.test(s.textContent)||s.nodeType!==Node.COMMENT_NODE&&r.appendChild(s)}),r}parse(t){t.childNodes.forEach(r=>{switch(r.nodeType){case Node.ELEMENT_NODE:this.parseElementNode(r);break;case Node.TEXT_NODE:this.parseTextNode(r);break}})}parseElementNode(t){const r=t.attributes;for(let s=0;s<r.length;s++){const{name:e,value:i}=r[s];if(e.startsWith("m-")){const n=e.slice(2);n.startsWith("text")&&(new l(i,this.$context,a=>{t.textContent=a}),t.removeAttribute(e)),n.startsWith("model")&&this.handleModel(t,n,e,i),n.startsWith("bind")&&this.handleBind(t,n,e,i)}if(e.startsWith(":")){const n=e.replace(":","bind:");this.handleBind(t,n,e,i)}if(e.startsWith("%")){const n=e.replace("%","model:");this.handleModel(t,n,e,i)}if(e.startsWith("@")){const n=e.replace("@",""),a=/\((.*)\)/,d=i.split(a).shift();let u=i.match(a)?i.match(a)[1].split(","):null;u!==null?(u=u.map(p=>p.trim()),t.addEventListener(n,()=>{this.$context.$methods[d](...u.map(p=>new Function("context",`with(context) {return ${p}}`)(this.$context)))})):t.addEventListener(n,()=>{this.$context.$methods[d].call(this.$context)}),t.removeAttribute(e)}}this.parse(t)}parseTextNode(t){var s;let r=(s=t.textContent)==null?void 0:s.trim();if(r!==void 0){const e=this.evaluateText(r);new l(e,this.$context,i=>{t.textContent=i})}}evaluateText(t){const r=/\{\{(.+?)}}/g;let s=t.split(r);const e=t.match(r);return s=s.filter(i=>i.length).map(i=>e&&e.indexOf(`{{${i}}}`)!==-1?`(${i})`:`"${i}"`),s.join("+")}handleModel(t,r,s,e){const i=t,n=r.split(":").pop();n!=="model"?(new l(e,this.$context,a=>{i[n]=a}),i.addEventListener("input",a=>{this.$context.$data[e]=a.target[n]})):(new l(e,this.$context,a=>{i.value=a}),i.addEventListener("input",a=>{this.$context.$data[e]=a.target.value})),t.removeAttribute(s)}handleBind(t,r,s,e){const i=r.split(":").pop();i!=="bind"?new l(e,this.$context,n=>{t[i]=n}):new l(e,this.$context,n=>{t.value=n}),t.removeAttribute(s)}}class ${constructor(t){o(this,"$el");o(this,"$data");o(this,"$methods");o(this,"$publisher");o(this,"$parser");this.$el=document.querySelector(t.el),this.$data=t.data,this.$methods=t.methods?t.methods:{},this.$publisher=new g(this.$data),this.proxyData(),this.proxyMethods(),this.$parser=new x(this)}proxyData(){Object.keys(this.$data).forEach(t=>{Object.defineProperty(this,t,{configurable:!0,enumerable:!0,set(r){this.$data[t]=r},get(){return this.$data[t]}})})}proxyMethods(){Object.keys(this.$methods).forEach(t=>{this.$methods[t]=this.$methods[t].bind(this),Object.defineProperty(this,t,{configurable:!0,enumerable:!0,get(){return this.$methods[t]}})})}$set(t,r,s){typeof t=="object"&&(t[r]=s,this.$publisher.reactive(t,r,s),Object.keys(t.__parent__).forEach(e=>{t.__parent__[e]===t&&(t.__parent__[e]=t)}))}$del(t,r){typeof t=="object"&&(Array.isArray(t)?t.splice(r,1):t[r]=void 0,Object.keys(t.__parent__).forEach(s=>{t.__parent__[s]===t&&(t.__parent__[s]=t)}))}}new $({el:"#app",data:{num:0,input:"Hello, world!",select:["Rust","Python","TypeScript","JavaScript"],selected:-1,title:"Mini MVVM Framework Demo"},methods:{incr(){this.num++}}});
